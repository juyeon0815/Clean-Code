## Chapter 9. 단위 테스트

### TDD 법칙 세 가지

> ##### 첫째 법칙 : 실패하는 단위 테스트를 작성할 때까지 실제 코드를 작성하지 않는다.
>
> ###### 둘째 법칙 : 컴파일은 실패하지 않으면서 실행이 실패하는 정도로만 단위 테스트를 작성한다.
>
> ###### 셋째 법칙 : 현재 실패하는 테스트를 통과할 정도로만 실제 코드를 작성한다.



위 세가지 규칙을 따르면 실제 코드를 전부 테스트하는 테스트 케이스가 나온다.

하지만 실제 코드와 맞먹을 정도로 방대한 테스트 코드는 심각한 관리 문제를 유발한다.



### 깨끗한 테스트 코드 유지하기

- 일회용 테스트 코드를 짜오다가 자동화된 단위 테스트 슈트를 짜기란 쉽지 않다.
- 실제 코드가 진화하면 테스트 코드도 변해야한다.
- 테스트 코드가 지저분할수록 변경하기 어려워진다.
-  테스트 코드가 복잡해질수록 실제 코드를 짜는 시간보다 테스트케이스를 추가하는 시간이 더 걸린다.

- 코드 변경 -> 기존 테스트 케이스 실패 : 실패하는 테스트 케이스를 통과하기 점점 어려워진다.



[테스트 슈트의 역할]

- 자신이 수정한 코드가 제대로 도는지 확인
- 수정한 시스템이 안전하다는 사실을 검증



**테스트 코드는 실제 코드 못지 않게 중요하다.**

내가 만든 테스트에 쏟아 부은 노력이 허사로 돌아가지 않도록 실제 코드 못지 않게 깨끗한 테스트 코드를 작성하자!



#### 테스트는 유연성, 유지보수성, 재사용성을 제공한다

- 단위 테스트는 코드의 유연성, 유지보수성, 재사용성을 제공하는 버팀목이다.
  - 테스트 케이스가 존재하면 변경이 쉬워진다.
- 실제 코드를 점검하는 자동화된 단위 테스트 슈트는 설계와 아키텍처를 최대한 깨끗하게 보존해야 한다.



### 깨끗한 테스트 코드

> 깨끗한 테스트 코드를 만드려면 **가독성**이 필요하다.

- 테스트 코드에 가독성을 높이려면?
  - 명료성, 단순성, 풍부한 표현력 필요
  - 최소한의 표현으로 많은 것을 나타내야 한다.



- 잡다하고 세세한 코드를 없앤다는 사실에 주목
- 테스트 코드는 진짜 필요한 자료 유형과 함수만 사용



### 테스트당 assert 하나

- assert 문이 단 하나인 함수는 결론이 하나라서 코드를 이해하기 쉽고 빠르다.



[테스트 당 개념 하나]

- 이것저것 잡다한 개념을 연속으로 테스트하는 긴 함수는 피한다.
- 한 함수로 몰아넣으면 독자가 각 절이 거기에 존재하는 이유와 각 절이 테스트하는 개념을 모두 이해해야 한다.



> 개념 당 assert문 수를 최소로 줄여라!
>
> 테스트 함수 하나는 개념 하나만 테스트하라!





### FIRST

> 깨끗한 테스트는 다임 다섯 가지 규칙을 따른다.

- Fast(빠르게) : 테스트는 빨리 돌아야 한다. 테스트가 느려 자주 돌리지 못한다면 초반에 문제를 찾아내 고치지 못한다.
- Independent(독립적으로) : 각 테스트는 서로 의존하면 안된다. 테스트가 서로에게 의존하면 하나가 실패할 때 나머지도 잇달아 실패하므로 원인을 진단하기 어려워지며 후반 테스트가 찾아내야 할 결함이 숨겨진다.
- Repeatable(반복가능하게) : 테스트는 어떤 환경에서도 반복 가능해야 한다.
- Self-Validating(자가검증하는) : 테스트는 실패/성공으로 결과를 내야 한다.
- Timely(적시에) : 테스트는 적시에 작성해야 한다.



### 결론

- 테스트 코드는 실제 코드의 유연성, 유지보수성, 재사용성을 보존하고 강화하기 때문에 중요하다.
- 테스트 코드는 지속적으로 깨끗하게 관리하자.
- 표현력을 높이고 간결하게 정리하자.
- 테스트 코드가 방치되어 망가지면 실제 코드도 망가진다.
- **테스트 코드를 깨끗하게 유지하자**